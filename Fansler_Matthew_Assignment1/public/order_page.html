<html> 
    <head>
        <script>
        // Assignment 1 sample code for class. Validation for footer, functions, header (order_page), images, loop with the shoes, and prices. 
        </script>
        <script src="./product_data.js" type="text/javascript"> //Product_data is reffrenced. 
        </script>
        <script> //Checks for appropreite functions check, no decimals, no letters, no negative numbers. 
                function isNonNegInt(q, return_errors = false) {
                    
                    errors = []; // No errors to begin
                    if(q == '') q =0; // Blank = 0
                    
                    //Number value, whichs remind client side.
                    if (Number(q) != q) errors.push('<font color="red">*Enter an amount!</font>'); 
                    else if (q < 0) errors.push('<font color="red">*Negative value!</font>'); // Non-negative check
                    else if (parseInt(q) != q) errors.push('<font color="red">Not an integer!</font>'); // Integer check
                    return return_errors ? errors : (errors.length == 0); 
                    //Return on Errors check
                }
            //Error and Quantity check
                function checkQuantityTextbox(theTextbox) {
                    errs = isNonNegInt(theTextbox.value, true);
                    if (errs.length == 0) errs = ['Your Quantity is:']; //When valid values are imputed, "Quantity" is replaced with "Your Quantity is"
                    if (theTextbox.value.trim() == '') errs = ['# of shoe pairs']; //Beginging value is states "# of shoe pairs"
                    document.getElementById(theTextbox.name + '_label').innerHTML = errs.join(", "); //"Your Qantity is" and "# of shoe pairs" will appear
                }
            // Check Paramaters
                window.onload = function () {
                    let params = (new URL(document.location)).searchParams; // Uses the query string to find the form data
                    // Check quantities to load to sever
                    if (params.has('purchase_submit')) {
                        has_errors = false; // Quantities are valid from begining
                        total_qty = 0; // Quantity > 0
                        for (i = 0; i < products.length; i++) {
                            if (params.has(`quantity${i}`)) { 
                                a_qty = params.get(`quantity${i}`);
                                // Textboxs for invalid inputs/values
                                product_selection_form[`quantity${i}`].value = a_qty;
                                total_qty += a_qty; //Sum of quantities calculation
                                if(!isNonNegInt(a_qty)) {
                                    has_errors = true; 
                                    // Invalid quantity check
                                    checkQuantityTextbox(product_selection_form[`quantity${i}`]); // Displays the error
                                }
                            }
                        }
                        // Displays pop up windows if quantities are invalid upon clicking the purchase button
                        if(has_errors) {
                            alert("Please enter only valid quantities!"); //Displays pop up window if "Please enter only valid quantities" if invalid inputs like letters/negative integers were inputted.
                        } else if(total_qty == 0) { 
                            alert("Please choose your amount of Shoes!"); //Displays pop up window "Please select some quantites" if form left blank.
                        } else { // Data is valid!
                            window.location = `./invoice.html${document.location.search}`; //Points to the next location (invoice.html) once validated by both the display page and server.
                            window.stop; //stops the page from loading
                        }
                    }
                }
                
            </script>
            <meta charset="utf-8">
            <title>Fansler's Vintage Shoeshop</title>
            <link href="https://fonts.googleapis.com/css?family=Cherry+Swash|Raleway" rel="stylesheet"> 
            <link rel="stylesheet" href="product-style.css" <="" head="">
        
        </head>
        </head>
        
        <body>
            <form name="product_selection_form" action="" method="GET">
                <header>
                    <h1>Fansler's Vintage Shoeshop</h1>
                </header>
                <div>
                    <main>
                        <script>
                            for (i = 0; i < products.length; i++) { //Loop with the array which shows the shoe brand name, descprition, image, and quantity.
                                document.write(`
                                    <section class="item">
                                        <h2>${products[i].Brand}</h2>
                                        <p>$${products[i].Price.toFixed(2)}</p>
                                        <p>${products[i].Description}</p>
                                        <label id="quantity${i}_label"}">Quantity</label>
                                        <input type="text" placeholder="0" name="quantity${i}" 
                                        onkeyup="checkQuantityTextbox(this);">
                                        <img src="${products[i].image}"> 
                                    
                                        </section>
                                `); 
                            }    
                        </script>
                                    <section class="item">
                                        <h2>Nike Shoes</h2>
                                        <p>$100.00</p>
                                        <p>Vintae Nike Shoes</p>
                                        <label id="quantity0_label" }"=""">Quantity</label>
                                        <input type="text" placeholder="0" name="quantity0" onkeyup="checkQuantityTextbox(this);">
                                        <img src="./images/Nike_blues.jpg"> 
                                    
                                        </section>
                                
                                    <section class="item">
                                        <h2>Adidas Shoes</h2>
                                        <p>$75.00</p>
                                        <p>Vintage Adidas Shoes</p>
                                        <label id="quantity1_label" }"="">Quantity</label>
                                        <input type="text" placeholder="0" name="quantity1" onkeyup="checkQuantityTextbox(this);">
                                        <img src="./images/Adidas.jpg"> 
                                    
                                        </section>
                                
                                    <section class="item">
                                        <h2>New Balance Shoes</h2>
                                        <p>$50.00</p>
                                        <p>Vintage New Balance Shoes</p>
                                        <label id="quantity2_label" }"="">Quantity</label>
                                        <input type="text" placeholder="0" name="quantity2" onkeyup="checkQuantityTextbox(this);">
                                        <img src="./images/New_Balance.jpg"> 
                                    
                                        </section>
                                
                                    <section class="item">
                                        <h2>Converse Shoes</h2>
                                        <p>$50.00</p>
                                        <p>Vintage Converse Shoes</p>
                                        <label id="quantity3_label" }"="">Quantity</label>
                                        <input type="text" placeholder="0" name="quantity3" onkeyup="checkQuantityTextbox(this);">
                                        <img src="./images/converse.jpg"> 
                                    
                                        </section>
                                
                                    <section class="item">
                                        <h2>Jordan Shoes</h2>
                                        <p>$100.00</p>
                                        <p>Vintage Jordan Shoes</p>
                                        <label id="quantity4_label" }"="">Quantity</label>
                                        <input type="text" placeholder="0" name="quantity4" onkeyup="checkQuantityTextbox(this);">
                                        <img src="./images/Jordans.jpg"> 
                                    
                                        </section>

                    </main>
                </div>
                <footer>
                    <h1>
                        Walk in Style!
                    </h1>
                    <input type="submit" value="Purchase!" name="purchase_submit"> 
                   <script>
                   //Creating the purchase button
                   </script>
                </footer>
            </form>
    </body>
</html>
